<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Nikke Burst Caculator ver 2.0</title>
    <style>
        
        :root{
            --bg-white: 255, 255, 255;
            --bg-black: 0, 0, 0;
            --bg-dark-gray: 50, 50, 50;
            --content-orange: 220, 160, 0;
            --content-light-orange: 255, 280, 60;
            --content-blue: 40, 140, 255;
            --content-dark-blue: 10, 35, 70;
            --enemy-color: 40, 140, 255;             
            --content-purple:255, 0, 255;
            --content-mainColor: 255, 255, 255;
            --content-reverseColor: 0, 0, 0;
            --border-radius: 2px;
            --margin-min: 4px;
            --margin: 8px;
            --margin-big: 12px;
            --font-weight-middle:500;
            --font-weight-heavy: 900;
            --border-line-heavy: 3px;
            --enemy-img: brightness(60%) sepia(100%) hue-rotate(200deg) saturate(2000%);
        }

        body{            
            background-color: rgb(var(--bg-black));
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
            display: flex;
            align-items: center;
            flex-direction: column;
            user-select: none;
            margin: 0;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        /*最外層*/
        .container { /* 企業排序 */
            margin-top: 0px;
            display: flex;
            flex-direction: column;
            width: 1024px;
            height: calc(100vh - 140px);
            padding-top: 48px;
            padding-bottom: 200px;
            overflow: auto;
            background-color: rgb(var(--bg-white),0.1);
        }
        .container::-webkit-scrollbar {
            display: none;
        }
        .filterBG {
            position: fixed;
            display: flex;
            justify-content: center;
            width: 1024px;
            height: 12px;
            background-color: rgb(var(--enemy-color));
            opacity: 0.9;
            z-index: 5;
            fill: rgb(var(--enemy-color));
        }
        #filter-container {
            position: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            top: 0;
            width: fit-content;            
            height: 40px;
            z-index: 5;
            gap: var(--margin-big);
        }
        .sort{
            display: flex;
            align-items: center;
            width: 72px;
            height: 24px;
            box-sizing: border-box;
            font-size: 16px;
            font-weight: 900;
            color: rgb(var(--bg-white));
            padding-left: var(--margin-min);
            border: 1px solid rgb(var(--bg-white));
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        .sort p {
            margin: 0;
            line-height: 1em;
        }
        .sort svg{
            fill: rgb(var(--bg-white));
        }
        .Filter{
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--margin);
        }        
        .filterBtn{            
            position: relative;
            display: flex;
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 24px;
            color: rgb(var(--bg-white));
            border: 1px solid rgb(var(--bg-white));
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        .filterBtn img{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: auto;
        } 
        .filterBtnOn{
            color: rgb(var(--bg-white), 0);
            background-color: rgb(var(--bg-white));
            border: none;
        }
        .filterBtnOn img{
            filter: var(--enemy-img);
        } 
        
        #SHstatus{
            display: flex;
            align-items: center;
            justify-content: center;
            width: 72px;
            height: 36px;
            color: rgb(var(--bg-white));            
            margin: 0;
            padding: 0;
            gap: var(--margin-min);
            overflow: hidden;
        }
        #SHstatus p{
            margin: 0;
            text-align: right;
            line-height: 1.2em;
            font-size: 10px;
        }
        .unRegularBtn {
            display: flex;            
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
            height: 24px;
            min-width: 36px;
            padding: var(--margin-min);
            border: 1px solid rgb(var(--bg-white));
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        .unRegularBtn p {
            font-family: 'Tahoma';
            font-weight: 900;
            transform: scaleX(0.8);

        }
        .unRegularBtnOn {
            color: rgb(var(--content-blue));
            background-color: rgb(var(--bg-white));
        }



        #column {
            position: relative;
            display: flex;            
            flex-wrap: wrap;
            justify-content: center;
            width: fit-content;
            margin: 4px;            
            border-radius: 8px;
            height: fit-content;
        }

        /*人物div*/
        .item {
            position: relative;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin: var(--margin-min); 
            width: 64px;
            height: 96px;
            align-items: center;
            background-color: rgba(var(--bg-white), 0.8);
            font-weight: var(--font-weight-middle);
            border-radius: var(--border-radius);
            cursor: pointer;
            white-space: nowrap;            
            box-shadow: 2px 2px 2px 0px rgb(var(--bg-black), 0.3);
        }
        .burst{
            position: absolute;
            top: 24%;
            left: 4%;
            width: 32%;
            height:fit-content;
            z-index: 1;
        }
        .burst img{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            }
        .burst svg{
            position: absolute;    
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);       
            width: 100%;
            stroke: rgb(var(--bg-white));
        }
        .charimg{
            width: 100%; 
            height: 100%;
            overflow: hidden;            
            border-radius: var(--border-radius);
        }
        .charimg img{
            width: 100%;
            transform: translate(0, -16%);
            object-position: top;
            object-fit: cover; 
        }
        .charactername{
            position: absolute;
            display: flex;
            bottom: 0;
            right: 0;
            margin: 0;
            margin-bottom: var(--margin-min);
            pointer-events: none;
            font-weight: 900;
            font-family: "Microsoft YaHei";
            font-size: 16px;
            letter-spacing: 2px;
            z-index: 2;
        }
        .itemhover{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(var(--content-orange), 0) 80%, rgba(var(--content-orange), 1));
            z-index: 1;
            border-radius: var(--border-radius);
        }
        .itemhover:hover{
            background: linear-gradient(to bottom, rgba(var(--content-light-orange), 0) 80%, rgba(var(--content-light-orange), 1));
            
        }
        .selectedCover{
            position: absolute;
            top: 0px;
            left: 0px;
            bottom: 0px;
            right: 0px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:rgb(var(--content-blue), 0.3);
            border: 2px solid rgb(var(--content-blue), 0.8);
            z-index: 3;
        }
        .selectedCover p{
            display: none;
        }
        .blocked .selectedCover{
            position: absolute;
            top: 0px;
            left: 0px;
            bottom: 0px;
            right: 0px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:rgb(var(--content-dark-blue), 0.7);
            border: 2px solid rgb(var(--content-dark-blue));
            font-weight: 900;
            gap: 0;
            font-family: 'Tahoma';
            z-index: 3;
        }
        .blocked .selectedCover p{
            display: flex;
            margin: 0;
            transform: scaleX(0.8);
            color: rgb(var(--content-blue));
        }
        .blockRound{
            font-size: 36px;
        }
        .selected .selectedCover{
            display: flex;
        }
        .unRegular{
            display: none;
        }
        .SRcharacter .itemhover{
            background: linear-gradient(to bottom, rgba(var(--content-purple), 0) 80%, rgba(var(--content-purple), 1));
        }
        
        /*計算區*/
        #bottomFix{
            position: fixed;
            display: flex;
            flex-direction: column;
            align-items:flex-end;
            width: 1048px;
            height: fit-content;
            bottom: 0;
            z-index: 5;
            box-shadow: -2px -2px 12px 0 rgb(var(--bg-black), 0.5);
            
        }
        #bottomFix p {
            margin: 0;
            padding: 0;
        }
        .caculateArea{
            display: flex;
            flex-direction: column;
            align-items: center;            
            box-sizing: border-box;
            width: 100%;
            height: fit-content;
            background-color: rgba(var(--bg-dark-gray));
            padding: var(--margin);
            padding-left: var(--margin-big);
            margin: 0;
            gap: var(--margin);
            border-radius: 8px 8px 0 0;      
        }
        .switchTargetBG {
            position: absolute;
            top: -4px;
            left: 0;
            display: flex; 
            width: 100%;
            height: 48px;
            background-color: rgb(var(--enemy-color));
            border-radius: 8px;
            z-index: -1;
        }
        .switchTarget{
            position: absolute;
            top: -4px;
            display: flex;
            justify-content: center;
            width: 100%;
            height: 16px;
            z-index: 1;
            color: rgb(var(--bg-white));
            cursor: pointer;
        }
        .switchTarget svg {
            position: absolute;
            top: 0;
            left: 50%;            
            transform: translate(-50%, 0%);
            z-index: -1;
            fill: rgb(var(--enemy-color));
        }

        .round-container{
            display: flex;
            gap: var(--margin);
            padding-top: 16px;
        }
        .round{
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(var(--bg-white));
            color: rgb(var(--bg-dark-gray));
            height: 24px;
            width: 54px;
            border-radius: var(--border-radius);
            font-size: 8px;
            font-weight: 900;
            font-family: 'Tahoma';
            box-shadow: 1px 1px 1px 0 rgb(var(--bg-black), 0.3);
            cursor: pointer;
        }
        .round p{           
            transform: scaleX(0.8);
        }
        .targetRound {
            background-color: rgb(var(--enemy-color));
            color: rgb(var(--bg-white));
        }
        .roundNumber{
            font-size: 12px;            
        }

        .caculate{
            position: relative;
            align-items:center;
            justify-content: center;
            display: flex;
            box-sizing: border-box;
            bottom: 0;
            left: 0;
            gap: var(--margin);
        }
        .cacuplace{
            width: 60px;
            height: 60px;
            background-color: rgba(87, 87, 87, 0.7);
            border-radius: 8px;
            overflow: hidden;
        }
        .cacuplace .item{
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
        }
        .cacuplace .item .charactername, .cacuplace .item .selectedCover{
            display: none;
        }
        
        .resultArea{
            position: relative;            
            flex-direction: column;
            padding: var(--margin);
            padding-bottom: 4px;
            border-radius: 5px;
            margin-bottom: var(--margin);            
            border: 2px solid rgb(var(--bg-dark-gray), 0.8);
        }
        .result{
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            gap: var(--margin-big);
            border-radius: var(--border-radius);
            font-size: 16px;
            margin: var(--margin-min);            
        }
        .burstResult{            
            font-weight: var(--font-weight-heavy);            
            margin: 0;
            padding: 0;
            line-height: 1em;
        }
        .previousResult{
            position: absolute;
            top: 10;
            right: var(--margin-big);
            margin: 0;
            padding-left: var(--margin-min);
            padding-right: var(--margin-min);            
            font-size: 12px;
            border-radius: 4px;
        }
        .initial, .over4RL{
            color: rgb(var(--bg-white), 0.5);
        }
        .twoRL{
            border: 2px solid #ff5454;            
            color: #ff5454;
        }        
        .twofiveRL{
            border: 2px solid #ffa44f;
            color: #ffa44f;
        }
        .threeRL{
            border: 2px solid #ffe344;
            color: #ffe344;
        }
        .threefiveRL{
            border: 2px solid #9dff4c;
            color: #9dff4c;
        }
        .fourRL{
            border: 2px solid #51ff94;
            color: #51ff94;
        }
        .enemy {
            position: absolute;                        
            flex-direction: row;
            align-items: center;
            justify-content: center;
            width: 100%;
            top: -56px;
            padding: 8px;
            margin: 0;
            border: none;
            background-color: rgb(var(--bg-black),0.8);
            z-index: -2;
        }
        .enemy .cacuplace{            
            width: 40px;
            height: 40px;
        }
        .enemy .burstResult{
            width: 72px;
        }
        .enemy .previousResult{
            display: none;
        }



        @media (max-width: 1024px) {
            .container {
                width: 100%;
            }         
        }
        @media (max-width: 560px) {  
            .container {
                padding-top: 84px; 
            }                   
            .preserveimg{
                width: 40px; 
                height: 48px;             
                object-position: top;
                object-fit: cover; 
            }
            .filterBG{
                height: 72px;
            }
            #filter-container{
                width: 375px; 
            }
            #burstFilter{
                position: absolute;
                top: 40px;
                left: 138px;
            }
        }


    </style>

</head>
<body>
    <div class="filterBG">
        <svg width="540" height="80" xmlns="http://www.w3.org/2000/svg">
            <polygon points="0,0 540,0 520,40 30,40"/>
          </svg>
    </div>
    <div id="filter-container">
        <div id="corpSort" class="sort">            
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M3 6C3 5 3 5 4 5H20C20 5 21 5 21 6C21 6 20 7 20 7H4C3 7 3 6 3 6Z" />
                <path d="M3 12C3 11 3 11 4 11H16C16 11 17 11 17 12C17 12 16 13 16 13H4C3 13 3 12 3 12Z"/>
                <path d="M3 18C3 17 3 17 4 17H12C12 17 13 17 13 18C13 18 12 19 12 19H4C3 19 3 18 3 18Z"/>
            </svg> 
            <p>充能</p>
        </div>
        <div id="speedSort"class="sort">            
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M3 6C3 5 3 5 4 5H20C20 5 21 5 21 6C21 6 20 7 20 7H4C3 7 3 6 3 6Z" />
                <path d="M3 12C3 11 3 11 4 11H16C16 11 17 11 17 12C17 12 16 13 16 13H4C3 13 3 12 3 12Z"/>
                <path d="M3 18C3 17 3 17 4 17H12C12 17 13 17 13 18C13 18 12 19 12 19H4C3 19 3 18 3 18Z"/>
            </svg>
            <p>企業</p>
        </div>
        <div id="burstFilter" class="Filter">            
            <div id="burst01" class="filterBtn">
                <img src="iconimg/burst_01.webp">
            </div>
            <div id="burst02" class="filterBtn">
                <img src="iconimg/burst_02.webp">
            </div>
            <div id="burst03" class="filterBtn">
                <img src="iconimg/burst_03.webp">
            </div>
        </div>
        <div id="corpFilter" class="Filter">            
            <div id="corp01" class="filterBtn">
                <img src="iconimg/corp_01.webp">
            </div>
            <div id="corp02" class="filterBtn">
                <img src="iconimg/corp_02.webp">
            </div>
            <div id="corp03" class="filterBtn">
                <img src="iconimg/corp_03.webp">
            </div>
            <div id="corp04" class="filterBtn">
                <img src="iconimg/corp_04.webp">
            </div>
            <div id="corp05" class="filterBtn">
                <img src="iconimg/corp_05.webp">
            </div>
        </div>
        <div id="SHstatus">
            <p>非常用角色</p>
            <div class="unRegularBtn">
                <p>Hide</p>
            </div>
        </div>
    </div>
    <div class="container">        
        <div id="column">
        </div>
  </div>  
  
    <div id="bottomFix">
        <div class="caculateArea">
            <div class="switchTargetBG">                
            </div>
            <div class="switchTarget">
                <svg width="120" height="18" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="0,0 120,0 110,18 10,18"/>
                  </svg>
                <p>設定敵方對伍</p>
            </div>
            <div class="round-container">
                <div id="round0" class="round targetRound">
                    <p>ROUND</p>
                    <p class="roundNumber">01</p>
                </div>
                <div id="round1" class="round">
                    <p>ROUND</p>
                    <p class="roundNumber">02</p>
                </div>
                <div id="round2" class="round">
                    <p>ROUND</p>
                    <p class="roundNumber">03</p>
                </div>
                <div id="round3" class="round">
                    <p>ROUND</p>
                    <p class="roundNumber">04</p>
                </div>
                <div id="round4" class="round">
                    <p>ROUND</p>
                    <p class="roundNumber">05</p>
                </div>
            </div>            
        </div>        
    </div>
    
    
  

  <script>    

    //速度級：級別代稱, 2RL, 2.5RL, 3RL, 3.5RL, 4RL, 額外充能
    var speed = [
        ["Helm", 39.82, 39.82, 59.73, 59.73, 79.64, 0],
        ["Trina", 28.8, 28.8, 43.2, 43.2, 57.6, 0],
        ["Jackal", 28.4, 28.4, 42.6, 42.6, 56.8, 1],
        ["Anis", 28.4, 28.4, 42.6, 42.6, 56.8, 0],
        ["Centi", 27.6, 27.6, 41.4, 41.4, 55.2, 0],
        ["Rumani", 26, 26, 39, 39, 52, 0],
        ["Emilia", 25.2, 25.2, 37.8, 37.8, 50.4, 0],
        ["Noah", 24, 24, 36, 36, 48, 0],
        ["Maiden: Ice Rose", 18.2, 18.2, 27.3, 27.3, 36.4],
        ["Drake", 18, 22.95, 27.45, 31.95, 36.45, 0],
        ["Noir", 18, 22.5, 27, 31.5, 36, 0],
        ["Laplace", 17.4, 17.4, 26.1, 26.1, 34.8, 0],
        ["Mica: Snow Buddy", 15.2, 18, 22.8, 26.8, 30.8, 0],
        ["Zwei", 14, 17.5, 21, 24.5, 28, 0],
        ["Nihilister", 14, 14, 25.2, 25.2, 36.4, 0],        
        ["Scarlet", 11.7, 13.5, 17.1, 20.25, 23.4, 1],
        ["Grave", 11.7, 13.5, 17.1, 20.25, 23.4, 0],
        ["A2", 11.7, 11.7, 23.4, 23.4, 23.4, 0],
        ["Rapunzel", 11.6, 11.6, 17.4, 17.4, 23.2, 0],
        ["Noise", 11.2, 11.2, 16.8, 16.8, 22.4, 0],
        ["Mana", 11.08, 12.78, 16.19, 19.17, 22.15, 0],
        ["Anis: Sparkling Summer", 10, 13, 13, 13, 15.5, 0],
        ["Scarlet: Black Shadow", 8.75, 11.25, 13.75, 18.75, 20, 1],
        ["Harran", 8.7, 8.7, 14.5, 14.5, 20.3, 1],        
        ["Privaty: Unkind Maid", 8.4, 10.4, 12.8, 14.6, 17.2, 0],
        ["Naga", 8, 10, 12, 14, 16, 0],
        ["Asuka", 7.8, 9, 11.4, 13.5, 15.6, 0],
        ["Soline", 7.6, 9, 11.4, 13.4, 15.4, 0],
        ["Moran", 6.5, 7.5, 9.5, 11.25, 13, 0],
        ["Sakura: Bloom in Summer", 5.8, 6.6, 8.4, 9.8, 11.4, 0],
        ["Rouge", 5.8, 5.8, 8.7, 8.7, 11.6, 0],
        ["Ludmilla", 5.7, 6.75, 8.55, 10.05, 11.55, 0],
        ["Ein", 5.6, 5.6, 14, 14, 16.8, 0],
        ["N102", 5.6, 5.6, 11.2, 11.2, 16.8, 0],
        ["Red Hood", 5.6, 5.6, 8.4, 8.4, 11.2, 1],
        ["Maxwell", 5.6, 5.6, 8.4, 8.4, 11.2, 0],
        ["Yulha", 5.5, 5.5, 8.25, 8.25, 11, 0],
        ["Admi", 5.4, 5.4, 8.1, 8.1, 10.8, 0],
        ["Frima", 5.3, 5.3, 7.95, 7.95, 10.6, 0],
        ["Blanc", 5.2, 6, 7.6, 9, 10.4, 0],
        ["Modernia", 3.4, 4.3, 7.1, 8.5, 10.5, 0],
        ["Liter", 3.2, 3.9, 5.4, 6.2, 6.9, 0],
        ["Alice", 2.8, 2.8, 5.6, 5.6, 8.4, 0],
        ["Cinderella", 2.025, 3.375, 4.725, 5.4, 7.2, 0],
        ["Rosanna", 1.8, 2.4, 3.65, 4.35, 5.35, 0],
        ["Crown", 1.7, 2.3, 3.55, 4.25, 5.25, 0],
        ["Snow White: Innocent Days", 1.3, 1.5, 1.9, 2.25, 2.6, 0]
    ];

    //角色資訊：企業, 英文, 中文, 編號, 速度級, burst, 常用標籤
    var character = [        
        ['Elysion', 'Neon: Blue Ocean', '泳尼恩', '014', 'Crown', '03', 'unRegular'],
        ['Elysion', 'Rapi: Red Hood', '紅帽拉毗', '016', 'Crown', '03', 'unRegular'],
        ['Elysion', 'Signal', '西格娜', '022', 'Liter', '03', 'unRegular'],
        ['Elysion', 'Poli', '波莉', '030', 'Naga', '02', 'unRegular'],
        ['Elysion', 'Miranda', '米蘭達', '032', 'Liter', '01', 'unRegular'],
        ['Elysion', 'Quiry', '基里', '033', 'Noise', '03', 'unRegular'],
        ['Elysion', 'D', 'D', '040', 'Liter', '03', 'unRegular'],
        ['Elysion', 'D: Killer Wife', '人妻 D', '043', 'Maxwell', '01', 'unRegular'],
        ['Elysion', 'Brid', '布麗德', '070', 'Blanc', '03', 'unRegular'],
        ['Elysion', 'Soline', '索林', '071', 'Blanc', '03', 'unRegular'],
        ['Elysion', 'Diesel', '迪塞爾', '072', 'Crown', '02', 'unRegular'],
        ['Elysion', 'Emma', '艾瑪', '090', 'Crown', '01', 'unRegular'],
        ['Elysion', 'Vesti', '貝斯蒂', '091', 'Noise', '03', 'unRegular'],
        ['Elysion', 'Eunhwa', '銀華', '092', 'Rouge', '02', 'unRegular'],
        ['Elysion', 'Privaty', '普麗瓦蒂', '170', 'Blanc', '03', 'regular'],
        ['Elysion', 'Guillotine', '吉蘿婷', '180', 'Crown', '03', 'unRegular'],
        ['Elysion', 'Maiden', '梅登', '181', 'Noir', '03', 'regular'],
        ['Elysion', 'Guillotine: Winter Slayer', '寒吉', '182', 'Blanc', '03', 'unRegular'],
        ['Elysion', 'Maiden: Ice Rose', '冰梅登', '183', 'Maiden: Ice Rose', '03', 'regular'],
        ['Elysion', 'Privaty: Unkind Maid', '兔普麗', '313', 'Privaty: Unkind Maid', '03', 'unRegular'],
        ['Elysion', 'Marciana', '瑪律恰那', '321', 'Naga', '02', 'unRegular'],
        ['Elysion', 'Mast', '馬斯特', '350', 'Liter', '02', 'unRegular'],
        ['Elysion', 'Helm', '海倫*', '352', 'Helm', '03', 'regular'],
        ['Elysion', 'Helm: Aquamarine', '泳海倫', '353', 'Blanc', '02', 'unRegular'],
        ['Elysion', 'Mast: Romantic Maid', '女僕馬斯特', '354', 'Crown', '02', 'unRegular'],
        ['Elysion', 'Anchor: Innocent Maid', '女僕安克', '355', 'Noise', '02', 'unRegular'],
        ['Elysion', 'Zwei', '茨瓦伊', '390', 'Zwei', '01', 'unRegular'],
        ['Elysion', 'Phantom', '潘托姆', '580', 'Moran', '03', 'unRegular'],
        ['Missilis', 'Centi', '桑迪', '080', 'Centi', '02', 'regular'],
        ['Missilis', 'Jackal', '豺狼', '111', 'Jackal', '01', 'regular'],
        ['Missilis', 'Drake', '德雷克*', '101', 'Drake', '03', 'regular'],
        ['Missilis', 'Pepper', '佩珀', '131', 'Noir', '01', 'regular'],
        ['Missilis', 'Laplace', '拉普拉斯*', '100', 'Laplace', '03', 'regular'],
        ['Missilis', 'Anne: Miracle Fairy', '聖誕安妮', '121', 'Noise', '02', 'regular'],
        ['Missilis', 'Tia', '蒂亞', '451', 'Noise', '01', 'regular'],
        ['Missilis', 'Trina', '特蕾娜', '412', 'Trina', '02', 'regular'],
        ['Missilis', 'Maxwell', '麥斯威爾', '102', 'Maxwell', '03', 'unRegular'],
        ['Missilis', 'Yuni', '尤妮', '160', 'N102', '02', 'unRegular'],
        ['Missilis', 'Liter', '麗塔', '082', 'Liter', '01', 'unRegular'],
        ['Missilis', 'Naga', '娜嘉', '450', 'Naga', '02', 'unRegular'],
        ['Missilis', 'Julia', '尤莉亞', '150', 'Blanc', '03', 'unRegular'],
        ['Missilis', 'Crow', '克拉烏', '110', 'Soline', '03', 'unRegular'],
        ['Missilis', 'Admi', '艾德米', '172', 'Admi', '02', 'unRegular'],
        ['Missilis', 'Guilty', '吉爾提', '400', 'Naga', '02', 'unRegular'],
        ['Missilis', 'Sin', '森', '401', 'Blanc', '02', 'unRegular'],
        ['Missilis', 'Quency', '坎西', '402', 'Soline', '02', 'unRegular'],
        ['Missilis', 'Epinel', '艾菲涅爾', '241', 'Liter', '03', 'unRegular'],
        ['Missilis', 'Tove', '托比', '192', 'Blanc', '01', 'unRegular'],
        ['Missilis', 'Elegg', '伊萊格', '500', 'Crown', '02', 'unRegular'],
        ['Missilis', 'Kilo', '吉洛', '361', 'Crown', '03', 'unRegular'],
        ['Missilis', 'Trony', '特羅尼', '501', 'Maxwell', '03', 'unRegular'],
        ['Missilis', 'Ein', '愛因', '391', 'Ein', '03', 'unRegular'],
        ['Missilis', 'Quency: Escape Queen', '怪盜坎西', '403', 'Ludmilla', '03', 'unRegular'],
        ['Missilis', 'Flora', '芙羅拉', '411', 'Crown', '02', 'unRegular'],
        ['Missilis', 'Mana', '瑪娜#', '290', 'Mana', '03', 'unRegular'],
        ['Tetra', 'Anis', 'SR阿妮斯', '012', 'Anis', '02', 'regular'],
        ['Tetra', 'Blanc', '布蘭兒', '270', 'Blanc', '02', 'regular'],
        ['Tetra', 'Rumani', '魯瑪妮', '240', 'Rumani', '01', 'regular'],
        ['Tetra', 'Viper', '毒蛇', '112', 'Noir', '02', 'regular'],
        ['Tetra', 'Sugar', '舒格', '140', 'Noir', '03', 'regular'],
        ['Tetra', 'Noir', '諾亞爾', '271', 'Noir', '03', 'regular'],
        ['Tetra', 'Soda: Twinkling Bunny', '索達兔', '314', 'Noir', '03', 'regular'],
        ['Tetra', 'Noise', '諾伊斯', '430', 'Noise', '01', 'regular'],
        ['Tetra', 'Biscuit', '餅乾', '381', 'Noise', '02', 'regular'],
        ['Tetra', 'Bay', '貝伊', '550', 'Noise', '02', 'regular'],
        ['Tetra', 'Anis: Sparkling Summer', '泳阿尼斯', '015', 'Anis: Sparkling Summer', '03', 'regular'],
        ['Tetra', 'Moran', '牡丹', '281', 'Moran', '01', 'regular'],
        ['Tetra', 'Rosanna', '羅珊娜', '280', 'Rosanna', '01', 'regular'],
        ['Tetra', 'Alice', '愛麗絲', '191', 'Alice', '03', 'regular'],
        ['Tetra', 'Rouge', '露姬', '272', 'Rouge', '01', 'unRegular'],
        ['Tetra', 'Ludmilla', '魯德米拉', '190', 'Ludmilla', '01', 'unRegular'],
        ['Tetra', 'Exia', '艾可希雅', '210', 'Maxwell', '01', 'unRegular'],
        ['Tetra', 'Frima', '普琳瑪', '142', 'Frima', '01', 'unRegular'],
        ['Tetra', 'Mary', '梅里', '130', 'Naga', '01', 'unRegular'],
        ['Tetra', 'Milk', '米爾克', '141', 'Maxwell', '01', 'unRegular'],
        ['Tetra', 'Yulha', '尤爾夏', '171', 'Yulha', '03', 'unRegular'],
        ['Tetra', 'Rupee', '露菲', '200', 'Blanc', '02', 'unRegular'],
        ['Tetra', 'Yan', '楊', '201', 'N102', '02', 'unRegular'],
        ['Tetra', 'Dolla', '朵拉', '202', 'Maxwell', '02', 'unRegular'],
        ['Tetra', 'Novel', '諾薇兒', '212', 'Liter', '02', 'unRegular'],
        ['Tetra', 'Folkwang', '富克旺', '242', 'Blanc', '02', 'unRegular'],
        ['Tetra', 'Sakura', '櫻花', '282', 'Admi', '01', 'unRegular'],
        ['Tetra', 'Cocoa', '可可', '311', 'Maxwell', '01', 'unRegular'],
        ['Tetra', 'Soda', '索達', '312', 'Crown', '01', 'unRegular'],
        ['Tetra', 'Rei', '萊伊', '392', 'Liter', '01', 'unRegular'],
        ['Tetra', 'Aria', '阿莉亞', '432', 'Crown', '02', 'unRegular'],
        ['Tetra', 'Volume', '沃綸姆', '431', 'Liter', '01', 'unRegular'],
        ['Tetra', 'Rupee: Winter Shopper', '冬露菲', '203', 'Blanc', '01', 'unRegular'],
        ['Tetra', 'Mary: Bay Goddess', '泳梅里', '132', 'Frima', '01', 'unRegular'],
        ['Tetra', 'Nero', '尼羅', '380', 'Liter', '02', 'unRegular'],
        ['Tetra', 'Ludmilla: Winter Owner', '冬魯德米拉', '194', 'Crown', '03', 'unRegular'],
        ['Tetra', 'Mica: Snow Buddy', '聖誕米卡**', '062', 'Mica: Snow Buddy', '01', 'unRegular'],
        ['Tetra', 'Leona', '萊昂納', '382', 'Naga', '02', 'unRegular'],
        ['Tetra', 'Ade', '愛德', '310', 'Moran', '02', 'unRegular'],
        ['Tetra', 'Alice: Wonderland Bunny', '愛麗絲兔', '195', 'Liter', '01', 'unRegular'],
        ['Tetra', 'Clay', '克雷伊', '551', 'Liter', '02', 'unRegular'],
        ['Tetra', 'Rosanna: Chic Ocean', '泳羅珊娜', '283', 'Blanc', '02', 'unRegular'],
        ['Tetra', 'Sakura: Bloom in Summer', '泳櫻花', '284', 'Sakura: Bloom in Summer', '03', 'unRegular'],
        ['Tetra', 'Bready', '布蕾德', '520', 'Maxwell', '03', 'unRegular'],
        ['Pilgrim', 'Noah', '諾雅', '232', 'Noah', '02', 'regular'],
        ['Pilgrim', 'Rapunzel', '長髮公主', '221', 'Rapunzel', '01', 'regular'],
        ['Pilgrim', 'Scarlet', '紅蓮', '222', 'Scarlet', '03', 'regular'],
        ['Pilgrim', 'Scarlet: Black Shadow', '暗影紅蓮', '225', 'Scarlet: Black Shadow', '03', 'regular'],
        ['Pilgrim', 'Red Hood', '小紅帽', '470', 'Red Hood', 'all', 'regular'],
        ['Pilgrim', 'Cinderella', '灰姑娘', '511', 'Cinderella', '03', 'regular'],
        ['Pilgrim', 'Crown', '皇冠', '330', 'Crown', '02', 'unRegular'],
        ['Pilgrim', 'Snow White', '白雪公主', '220', 'Moran', '03', 'unRegular'],
        ['Pilgrim', 'Isabel', '伊莎貝爾', '231', 'Naga', '03', 'unRegular'],
        ['Pilgrim', 'Harran', '哈蘭', '230', 'Harran', '03', 'unRegular'],
        ['Pilgrim', 'Modernia', '神罰', '260', 'Modernia', '03', 'unRegular'],
        ['Pilgrim', 'Nihilister', '尼希利斯塔', '261', 'Nihilister', '02', 'unRegular'],
        ['Pilgrim', 'Dorothy', '桃樂絲', '233', 'Blanc', '01', 'unRegular'],
        ['Pilgrim', 'Snow White: Innocent Days', '小白雪', '224', 'Snow White: Innocent Days', '03', 'unRegular'],
        ['Pilgrim', 'Rapunzel: Pure Grace', '小長髮', '226', 'Maxwell', '01', 'unRegular'],
        ['Pilgrim', 'Grave', '格拉維', '514', 'Grave', '02', 'unRegular'],
        ['Abnormal', 'Emilia', '愛蜜莉雅', '821', 'Emilia', '03', 'regular'],
        ['Abnormal', 'Makima', '真紀真', '800', 'Liter', '02', 'unRegular'],
        ['Abnormal', 'Power', '帕瓦', '801', 'Noise', '03', 'unRegular'],
        ['Abnormal', '2B', '2B', '810', 'Blanc', '03', 'unRegular'],
        ['Abnormal', 'A2', 'A2', '811', 'A2', '03', 'unRegular'],
        ['Abnormal', 'Rem', '雷姆', '820', 'Crown', '02', 'unRegular'],
        ['Abnormal', 'Asuka', '明日香', '830', 'Asuka', '03', 'unRegular'],
        ['Abnormal', 'Rei', '零', '831', 'Crown', '03', 'unRegular'],
        ['Abnormal', 'Mari', '真理', '832', 'Maxwell', '02', 'unRegular'],
        ['Abnormal', 'Asuka: WILLE', '風明日香', '835', 'Crown', '03', 'unRegular'],
        ['Abnormal', 'Rei (Tentative Name)', '零 暫稱', '834', 'Moran', '03', 'unRegular']
    ];

    // SR角色列表
    var srList = ["012"]; 

    const speedContainer = document.querySelector('.speed-container');
    const container = document.querySelector('.container');
    const column = document.getElementById('column');


    //優化圖片載入時間點
    document.addEventListener('DOMContentLoaded', () => {
        //pvp常用角優先載入
        const allPvpImages = document.querySelectorAll('img[data-group="regular"]');
        allPvpImages.forEach(pvpimg => {
            pvpimg.src = pvpimg.dataset.src;
            delete pvpimg.dataset.src;
        });  
    });

        
    //建立角色item
    for (let i = 0; i < character.length; i++) {
        if (character[i]) {

            let charactername = character[i][2];

            let charId = 'c';
            charId += character[i][3];
            let photosrc = "charimg/";
            photosrc += character[i][3];
            photosrc += ".webp";
            let burst = 'burst';
            burst += character[i][5];
            

            const item = document.createElement('div');
            item.classList.add('item', charId, character[i][0], burst, character[i][6]);
            
            //SR角色控制
            for(let j = 0; j < srList.length; j++){
                if (srList[j] == character[i][3]) {
                    item.classList.add('SRcharacter');
                };
            };
            
            item.innerHTML = `
            <div class="selectedCover">
                <p>round</p>
                <p class="blockRound"></p>
                <p class="enemyBlockRound" style="display: none"></p>
            </div>
            <div class="itemhover">
            </div>
            <div class="burst">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="24" viewBox="0 0 20 24" fill="none">
                    <path d="M0 6L10 0L20 6V18L10 24L0 18V6Z" fill="#232323"/>
                </svg>
                <img src="iconimg/burst_${character[i][5]}.webp">
            </div>
            <div class="charimg">
            <img data-group=${character[i][6]} data-src=${photosrc} alt="Delayed Image">
            </div>

            <svg class=charactername viewBox="0 0 100 30" xmlns="http://www.w3.org/2000/svg">
                <text x="97%" y="80%" text-anchor="end" stroke="rgba(var(--bg-dark-gray)" stroke-width="4" fill="rgba(var(--content-orange)">
                    ${charactername}
                </text>
                <text x="97%" y="80%" text-anchor="end"  fill="rgba(var(--content-orange)">
                    ${charactername}
                </text>                
            </svg>
            `;            
            column.appendChild(item);            
        };
    };

    
    //將陣列依企業排序
    const corpOrder = ['Elysion', 'Missilis', 'Tetra', 'Pilgrim', 'Abnormal'];
    function corpSort(arr, order) {
        arr.sort((a, b) => {
            // 先比較企業
            if (a[0]!== b[0]) {
                return order.indexOf(a[0]) - order.indexOf(b[0]);
            } else {
                return a[3] - b[3]; // 部隊比較
            }           
        });
        return arr;
    };

    //將陣列依速度排序
    function speedSort(arr, order) {
        arr.sort((a, b) => {
            // 先比較爆裂速度
            let aIndex = -1;
            let bIndex = -1;
            if (a[4]!== b[4]) {
                for (let i = 0; i < order.length; i++) {
                    if (a[4] === order[i][0]) {
                        aIndex = i;
                    }
                    if (b[4] === order[i][0]) {
                        bIndex = i;
                    }
                };
                return aIndex - bIndex;
            } else {
                return a[3] - b[3]; // 部隊比較
            }           
        });
        return arr;
    };

    //將item依陣列排序
    const chars = document.querySelectorAll('.item');
    let characterSort ="";
    function sort() {
        chars.forEach(char => {
            char.style.order = "";
            for(let i = 0; i < characterSort.length; i++) {                
                if (char.classList[1].slice(1) === characterSort[i][3]) {
                    char.style.order = i;
                };
            };            
        });
    };    

    // 初始排序(依企業排序)
    const corpSortButton = document.getElementById('corpSort');
    const speedSortButton = document.getElementById('speedSort');
    characterSort = corpSort(character, corpOrder);
    sort();
    let sortType = 'corpSort'; // 追蹤排序狀態
    corpSortButton.style.display = 'none';


    //企業排序    
    corpSortButton.addEventListener('click', () => {        
        if (sortType !== 'corpSort') {
            characterSort = corpSort(character, corpOrder);
            sort();
            sortType = 'corpSort';
            corpSortButton.style.display = 'none';
            speedSortButton.style.display = 'flex';
        }
    });

    //充能速度排序    
    speedSortButton.addEventListener('click', () => {
        if (sortType !== 'speedSort') {
            characterSort = speedSort(character, speed);
            sort();
            sortType = 'speedSort';
            corpSortButton.style.display = 'flex';
            speedSortButton.style.display = 'none';
        }
    });

    

    //非常用角篩選
    let unRegularStatus = 0;

    const unRegularBtn = document.querySelector('.unRegularBtn');
    const unRegularImages = document.querySelectorAll('img[data-group="unRegular"]');
    unRegularBtn.addEventListener('click', () => {
        unRegularStatus = 1 - unRegularStatus;
        if (unRegularStatus == 1) {
            unRegularBtn.classList.add('unRegularBtnOn');
            unRegularBtn.innerHTML =`<p>Show</p>`;
            unRegularImages.forEach(unRegularImage => {
                if (unRegularImage.dataset.src) {
                    unRegularImage.src = unRegularImage.dataset.src;
                    // (可選) 移除 data-src 屬性，避免重複載入
                    delete unRegularImage.dataset.src;
                };
            });
            checkFilter();
        } else {
            unRegularBtn.classList.remove('unRegularBtnOn');
            unRegularBtn.innerHTML =`<p>Hide</p>`;
            checkFilter();
        };
        

    })
    
    //企業與爆裂篩選狀態儲存
    var burstStatus = [ 0, 0, 0];    
    var corpStatus = [ 0, 0, 0, 0, 0];
    
    //check角色篩選顯示狀態
    function checkFilter() {
        chars.forEach(char => {            
            char.style.display = "none";
            for (let i = 0; i < burstStatus.length; i++) {                
                for (let j = 0; j < corpStatus.length; j++) {
                    //都被選上時顯示
                    if (burstStatus[i] === 1 && corpStatus[j] === 1) {
                        if (unRegularStatus=== 0) {
                            if(char.classList[3].slice(-1) == i+1 && char.classList[2] == corpOrder[j] && char.classList[4]==="regular"){
                                char.style.display = "flex";
                            }
                            if (char.classList[3] == "burstall" && char.classList[2] == corpOrder[j] && char.classList[4]==="regular"){ //burstall要顯示
                                char.style.display = "flex";
                            }
                        } else {
                            if(char.classList[3].slice(-1) == i+1 && char.classList[2] == corpOrder[j]) {
                                char.style.display = "flex";
                            }
                            if (char.classList[3] == "burstall" && char.classList[2] == corpOrder[j]){ //burstall要顯示
                                char.style.display = "flex";
                            }
                        }
                    //burst選上，企業全部未選                    
                    } else if (burstStatus[i] === 1 && corpStatus.indexOf(1) === -1) {
                        if (unRegularStatus=== 0) {
                            if(char.classList[3].slice(-1) == i+1  && char.classList[4]==="regular"){
                                char.style.display = "flex";
                            }
                            if (char.classList[3] == "burstall" && char.classList[4]==="regular"){ //burstall要顯示
                                char.style.display = "flex";
                            }
                        } else {
                            if(char.classList[3].slice(-1) == i+1) {
                                char.style.display = "flex";
                            }
                            if (char.classList[3] == "burstall"){ //burstall要顯示
                                char.style.display = "flex";
                            }
                        }
                    //burst全部未選，企業選上  
                    } else if (burstStatus.indexOf(1) === -1 && corpStatus[j] === 1){
                        if (unRegularStatus=== 0) {
                            if(char.classList[2] == corpOrder[j] && char.classList[4]==="regular"){
                                char.style.display = "flex";
                            }
                        } else {
                            if(char.classList[2] == corpOrder[j]) {
                                char.style.display = "flex";
                            }
                        } 
                    //全部未選
                    } else if (burstStatus.indexOf(1) === -1 && corpStatus.indexOf(1) === -1) {
                        if (unRegularStatus=== 0) {
                            if(char.classList[4]==="regular"){
                                char.style.display = "flex";
                            }
                        } else {
                            char.style.display = "flex";
                        } 
                    }
                };
            };
        });
    };
    
    
    //爆裂篩選開關
    const Burst01Button = document.getElementById('burst01');
    const Burst02Button = document.getElementById('burst02');
    const Burst03Button = document.getElementById('burst03');    

    const burstButtons = [Burst01Button, Burst02Button, Burst03Button];
    burstButtons.forEach((button, index) => {
        button.addEventListener('click', () => {
            burstStatus[index] = 1 - burstStatus[index]; // 切換 0 和 1

            if (burstStatus[index] === 1) {
                button.classList.add("filterBtnOn");
            } else {
                button.classList.remove("filterBtnOn");
            }            
            checkFilter();
        });
    });

    //企業篩選開關
    const corp01Button = document.getElementById('corp01');
    const corp02Button = document.getElementById('corp02');
    const corp03Button = document.getElementById('corp03');
    const corp04Button = document.getElementById('corp04');
    const corp05Button = document.getElementById('corp05');

    const corpButtons = [corp01Button, corp02Button, corp03Button, corp04Button, corp05Button];
    corpButtons.forEach((button, index) => {
        button.addEventListener('click', () => {
            corpStatus[index] = 1 - corpStatus[index]; // 切換 0 和 1

            if (corpStatus[index] === 1) {
                button.classList.add("filterBtnOn");
            } else {
                button.classList.remove("filterBtnOn");
            }

            checkFilter();
        });
    });


    //建立計算區    
    let round = 0;//設定初始隊伍
    let target = 0;//設定初始對象 0=自己 1=對方
   
    const caculateArea = document.querySelector(".caculateArea");
    for (let i = 0; i < 2; i++) {
        for(let j = 0; j < 5; j++) {
            const resultArea = document.createElement('div');
            let resultAreaID = "resultArea";
            resultAreaID += i ;
            resultAreaID += j ;
            resultArea.id =  resultAreaID;
            resultArea.classList.add('resultArea');        
            resultArea.classList.add('initial');
            const caculate = document.createElement('div');
            caculate.classList.add('caculate');
            
            for (let k = 0; k < 5; k++) {
                const cacuplace = document.createElement('div');
                let cacuplaceID = "cacuplace";
                cacuplaceID += k;
                cacuplace.id = cacuplaceID;
                cacuplace.classList.add('cacuplace');
                caculate.appendChild(cacuplace);
            };
            const result = document.createElement('div');
            result.classList.add('result');
            if (i == 0){
                result.innerHTML = `
                    <p class="burstResult">點選角色開始計算</p>
                `;
            } else {
                result.innerHTML = `
                    <p class="burstResult">尚未選擇角色</p>
                `;
            }
            
            resultArea.appendChild(caculate);
            resultArea.appendChild(result);    
            caculateArea.appendChild(resultArea);
        };
    };

    //僅顯示當前目標計算區與對手計算區
    const switchTarget = document.querySelector(`.switchTarget`);
    let enemySet = 0;
    function showTargetArea(target, round) {
        const hideArea = caculateArea.getElementsByClassName("resultArea"); 
        const lastRound = caculateArea.querySelector(`.targetRound`);
        const lastEnemy = caculateArea.querySelector(`.enemy`); 
        Array.from(hideArea).forEach(result => {
            result.style.display = "none";
            lastRound.classList.remove('targetRound');
            if(lastEnemy) {
                lastEnemy.classList.remove('enemy');
            }
        });
        const targetArea = caculateArea.querySelector(`#resultArea${target}${round}`);
        const enemyArea = caculateArea.querySelector(`#resultArea${1-target}${round}`);
        const taegetRound = caculateArea.querySelector(`#round${round}`); 
        
        targetArea.style.display = "flex";
        if (enemySet == 1) {
            enemyArea.style.display = "flex";
        }
        taegetRound.classList.add('targetRound');
        enemyArea.classList.add('enemy');
        const rootElement = document.documentElement;        
        const switchP = switchTarget.querySelector(`p`);
        if (target == 1){            
            rootElement.style.setProperty('--enemy-color', '255, 40, 40');
            rootElement.style.setProperty('--enemy-img', 'brightness(60%) sepia(100%) hue-rotate(330deg) saturate(2000%)');
            switchP.textContent ='設定敵方隊伍';
        } else {
            rootElement.style.setProperty('--enemy-color', '40, 140, 255');
            rootElement.style.setProperty('--enemy-img', 'brightness(60%) sepia(100%) hue-rotate(200deg) saturate(2000%)');
            switchP.textContent ='設定己方隊伍';
        }
    };
    showTargetArea(target, round);

        
    //計算區空位
    const selectedChars = Array.from({ length: 2 }, () =>
        Array.from({ length: 5 }, () => Array( 5 ).fill(null))
    );
    const speedchars = Array.from({ length: 2 }, () =>
        Array.from({ length: 5 }, () => Array( 5 ).fill(null))
    );
    
    //切換round
    const targetRounds = document.getElementsByClassName("round");    
    Array.from(targetRounds).forEach(targetRound => {
        targetRound.addEventListener('click', () =>{

            const selecteds = document.getElementsByClassName("selected");
            Array.from(selecteds).forEach(selected => {
                selected.classList.add('blocked');
                selected.classList.remove('selected');
            });
            
            const enemySelecteds = document.getElementsByClassName("enemySelected");
            Array.from(enemySelecteds).forEach(enemySelected => {
                enemySelected.classList.add('enemyBlocked');
                enemySelected.classList.remove('enemySelected');
            });

            round = Number(targetRound.id.slice(-1));

            const blockeds = document.getElementsByClassName("blocked");
            Array.from(blockeds).forEach(blocked => {
                for (let i = 0; i < 5; i++) {
                    if (selectedChars[target][round][i] && blocked.classList[1] === selectedChars[target][round][i].classList[1]) {
                        blocked.classList.add('selected');
                        blocked.classList.remove('blocked');                            
                    }
                    ;
                };
            });

            const enemyblockeds = document.getElementsByClassName("enemyBlocked");
            Array.from(enemyblockeds).forEach(enemyblocked => {
                for (let i = 0; i < 5; i++) {
                    if (selectedChars[1-target][round][i] && enemyblocked.classList[1] === selectedChars[1-target][round][i].classList[1]) {
                        enemyblocked.classList.add('enemySelected');
                        enemyblocked.classList.remove('enemyBlocked');                            
                    }
                    ;
                };
            });
           
            showTargetArea(target, round);
        });        
    });

    
    //切換target
    
    
    switchTarget.addEventListener('click', () =>{
        let emptyCheck = 1;
        for (let i = 0; i < 5; i++) {
            if(selectedChars[target][i].every(element => element ===null)){
                emptyCheck = emptyCheck * 1;
            }else{
                emptyCheck = emptyCheck * 0;
            }
        }
        console.log(emptyCheck);
        if (emptyCheck == 1) {
            enemySet = 0;
        } else {
            enemySet = 1;
        }
        target = 1-target;
        chars.forEach(char => {
            const blockRound = char.querySelector('.blockRound');
            const enemyBlockRound = char.querySelector('.enemyBlockRound');            
            if (blockRound || enemyBlockRound) {
                let nowRound = blockRound.textContent;
                let enemyRound = enemyBlockRound.textContent;
                blockRound.textContent = enemyRound;
                enemyBlockRound.textContent = nowRound;                         
            }
            const statusMenu = ['selected', 'blocked', 'enemySelected', 'enemyBlocked']
            const status = [0, 0, 0, 0];
            
            if (char.classList.contains('selected')) {
                status[0] = 1;
            }            
            if (char.classList.contains('blocked')) {
                status[1] = 1;
            }
            if (char.classList.contains('enemySelected')) {
                status[2] = 1;
            }
            if (char.classList.contains('enemyBlocked')){
                status[3] = 1;
            }
            char.classList.remove('selected', 'blocked', 'enemySelected', 'enemyBlocked');
            if (status[0] == 1) {
                char.classList.add('enemySelected');
            }
            if (status[1] == 1) {
                char.classList.add('enemyBlocked');
            }
            if (status[2] == 1) {
                char.classList.add('selected');
            }
            if (status[3] == 1) {
                char.classList.add('blocked');
            }                       
        });
        showTargetArea(target, round);        
    });

    //取消選取時清除隊應儲存陣列
    function clearArr(arr, target, round, index) {
        arr[target][round][index] = null;
        return arr;
    };

    //選取角色
    chars.forEach(char => {
        char.addEventListener('click', () => {
            let index = selectedChars[target][round].indexOf(char);
            
            if (char.classList[char.classList.length - 1] != `blocked`) {
                if (index !== -1) {
                    // 如果已選取，則取消選取
                    char.classList.remove(`selected`);
                    
                    // 清除陣列
                    clearArr(selectedChars, target, round, index);
                    clearArr(speedchars, target, round, index);
                    
                    const targetArea = document.querySelector(`#resultArea${target}${round}`);
                    const cacuplace = targetArea.querySelector(`#cacuplace${index}`);
                    cacuplace.replaceChildren();
                } else {
                    // 如果未選取，則新增選取
                    const emptyIndex = selectedChars[target][round].findIndex(item => item === null);                

                    if (emptyIndex !== -1) {
                        // 檢查是否已達到選取上限
                        if (selectedChars[target][round].filter(item => item !== null).length < 5) {
                            selectedChars[target][round][emptyIndex] = char;
                            char.classList.add(`selected`);
                            const blockRound = char.querySelector(`.blockRound`);                        
                            let showRound = round;
                            showRound += 1;
                            blockRound.textContent = `0${showRound}`;
                            const clonedchar = char.cloneNode(true);                        

                            character.forEach((subArray) => {
                                if (subArray[3] === clonedchar.classList[1].slice(1)) {
                                    const charspeed = subArray[4];

                                    speed.forEach((speedsubArray) => {
                                        if (speedsubArray[0] === charspeed) {
                                            speedchars[target][round][emptyIndex] = speedsubArray; // 將 speed 子陣列存儲到 speedchars
                                            
                                        };
                                    });
                                };
                            });
                            //控制計算區的角色名稱
                            clonedchar.classList.add('cacuplaceItem');
                            const caculateName = clonedchar.querySelectorAll('.charactername');
                            caculateName.forEach( element => {
                                element.classList.add('caculateName');
                            });

                            
                            const targetArea = document.querySelector(`#resultArea${target}${round}`);
                            const cacuplace = targetArea.querySelector(`#cacuplace${emptyIndex}`);
                            cacuplace.appendChild(clonedchar);

                            // 為 cacuplace 中的 clonedchar 添加點擊事件監聽器
                            clonedchar.addEventListener('click', function(event) {
                                event.stopPropagation(); // 阻止事件阻擋

                                // 找到 clonedchar 在 selectedChars 中的索引
                                const clonedIndex = selectedChars[target][round].indexOf(char);
                                if (clonedIndex !== -1) {
                                    // 取消選取
                                    char.classList.remove(`selected`);
                                    selectedChars[target][round][clonedIndex] = null;                                
                                    speedchars[target][round][clonedIndex] = null;
                                    cacuplace.replaceChildren();
                                    
                                    //更新總速度和加成
                                    calculateAndDisplay();
                                };
                            });
                        };
                    };
                };
            };

            // 計算總速度和加成
            function calculateAndDisplay() {                
                const sums = {
                    twoRL: 0,
                    twofiveRL: 0,
                    threeRL: 0,
                    threefiveRL: 0,
                    fourRL: 0,
                    bonusSpeed: 0
                };

                speedchars[target][round].forEach(subArray => {
                    if (subArray) {
                        sums.twoRL += subArray[1] || 0;
                        sums.twofiveRL += subArray[2] || 0;
                        sums.threeRL += subArray[3] || 0;
                        sums.threefiveRL += subArray[4] || 0;
                        sums.fourRL += subArray[5] || 0;
                        sums.bonusSpeed += subArray[6] || 0;
                    };
                });                

                // 處理浮點數精度問題並找到最大值
                let maxKey = "over4RL"; // 預設值
                let maxValue = 0;
                
                for (const key in sums) {
                    sums[key] = Math.round(sums[key] * 100) / 100; // 四捨五入到小數點後兩位

                    if (sums[key] >= 100) {
                        if (maxValue === 0 || sums[key] < maxValue) {
                            maxValue = sums[key];                            
                            maxKey = key;                            
                        };
                    };
                };            

                // 設定結果名稱
                let resultname = maxKey;                
                let previousSentence = "";
                let previousClass = "";
                if (maxKey === "twoRL"){
                    resultname = "2RL";
                    previousSentence ="";
                };
                if (maxKey === "twofiveRL"){
                    resultname = "2.5RL";
                    previousClass = "twoRL";
                    previousSentence = "2RL(";
                    previousSentence += sums.twoRL;
                    previousSentence += ")";
                };
                if (maxKey === "threeRL"){
                    resultname = "3RL";                    
                    previousClass = "twofiveRL";
                    previousSentence = "2.5RL(";
                    previousSentence += sums.twofiveRL;
                    previousSentence += ")";
                };
                if (maxKey === "threefiveRL"){
                    resultname = "3.5RL";
                    previousClass = "threeRL";
                    previousSentence = "3RL(";
                    previousSentence += sums.threeRL;
                    previousSentence += ")";
                };
                if (maxKey === "fourRL"){
                    resultname = "4RL";
                    previousClass = "threefiveRL";
                    previousSentence = "3.5RL(";
                    previousSentence += sums.threefiveRL;
                    previousSentence += ")";
                };
                if (sums.bonusSpeed > 0) {
                resultname += "+";
                };

                // 顯示結果
                const targetArea = document.querySelector(`#resultArea${target}${round}`);
                targetArea.className = `resultArea`;
                targetArea.classList.add(maxKey);
                let finalspeed = 0;

                if(maxValue === 0){
                    finalspeed = sums.fourRL;
                } else {
                    finalspeed = maxValue;
                };
                const result = targetArea.querySelector(`.result`);
                result.innerHTML = `
                    <p class="burstResult">${resultname} (${finalspeed})</p>
                    <p class="previousResult ${previousClass}"> ${previousSentence}</p>
                `;                
            }
            calculateAndDisplay();
            
        });
    });
    
    
    
  </script>
  
    
</body>
</html>
