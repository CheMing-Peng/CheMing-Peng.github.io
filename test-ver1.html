<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        
        body{
            background-color: rgb(0, 0, 0);
        }

        /*最外層*/
        .container {
          display: flex;
          justify-content: start; 
          width: 100%;
        }
        .blank{
            height: 150px;
        }

        /*企業div*/
        .column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;            
            margin: 2px;
            position: relative;
            border-radius: 8px;
            border-top: #ffffff 1px;
            overflow: hidden;
            height: fit-content;
        }
        #Elysioncolum{
            width: 12%;
        }
        #Tetracolum{
            width: 30%;
        }
        #Missiliscolum, #Pilgrimcolum{
            width: 24%;
        }
        #Abnormalcolum{
            width: 10%;
        }
        .columnin{
            display: flex;
            flex-wrap: wrap;
            align-items: start;
            position: relative;            
            width: 100%;
        }
        .show{            
            width: 100%;
            padding-left: 8px;
            font-size: 12px;
            font-weight: 900;
            text-decoration: underline;
            font-family: Arial, Helvetica, sans-serif;
            color: rgb(255, 255, 255);
            cursor: pointer;
        }
        .hide{
            order: 999;
            width: 100%;
            padding-left: 8px;
            font-size: 12px;
            font-weight: 900;
            text-decoration: underline;
            font-family: Arial, Helvetica, sans-serif;
            color: rgb(255, 255, 255);
            cursor: pointer;
        }

        /*企業標題*/
        .enterprise{
            margin: 0;
            width: 100%;
            height: fit-content;
            padding-left: 4px;
            padding-bottom: 4px;
            font-size: 20px;
            font-weight: 900;
            font-family: Arial, Helvetica, sans-serif;
            background-color: rgb(0, 0, 0, 0.5);
            color: rgb(255, 255, 255);            
        }

        /*人物div*/
        .item {
            position: relative;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin: 4px; 
            width: 64px;
            height: 92px;
            align-items: center;
            background-color: rgba(150, 150, 150, 0.9);
            border: 1px solid rgba(255, 255, 255);
            font-size: 12px;
            font-weight: 500;
            border-radius:5px;
            gap: 4px;
            cursor: pointer;
            padding-top: 2px;            
        }
        
        .item img{
            width: 50px; 
            height: 64px;             
            object-position: top;
            object-fit: cover; 
            border-radius: 5px;
        }
        .charactername{
            margin: 0px;
            margin-bottom: 4px;
            pointer-events: none;
        }
        .itemhover{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 50%, rgba(255, 0, 0, 0));
        }
        .itemhover:hover{
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 50%, rgba(255, 0, 0, 0.2));
            
        }
        .selected1{
            background-color: rgba(255, 255, 255, 1);
            border: 3px solid rgb(255, 0, 0,0.5);
            padding-top: 0px;
        }
        .selected2{
            background-color: rgba(255, 255, 255, 1);
            border: 3px solid rgba(0, 255, 76, 0.5);
            padding-top: 0px;
        }
        .selected3{
            background-color: rgba(255, 255, 255, 1);
            border: 3px solid rgba(0, 60, 255, 0.5);
            padding-top: 0px;
        }
        .selected4{
            background-color: rgba(255, 255, 255, 1);
            border: 3px solid rgba(255, 0, 234, 0.5);
            padding-top: 0px;
        }
        .selected5{
            background-color: rgba(255, 255, 255, 1);
            border: 3px solid rgba(255, 166, 0, 0.5);
            padding-top: 0px;
        }
        

        /*企業logo*/
        .corpbk{
            position: absolute; 
            top: 0;
            left: 0;          
            width: 100%; 
            height: 100%;
            z-index: -2;
            background-color: rgb(40, 40, 40);                       
        }
        .corplogo{
            position: relative;
            top: 0;
            left: 0;          
            width: 100%; 
            height: 100%;
        }
        .corplogo img{
            position: absolute;
            top: -5%;
            right: -2%;
            max-width: 60%;
            min-width: 100px;
            z-index: -1;
        }     
        
        /*計算區*/
        .caculateArea{
            position: fixed;
            display: flex;
            flex-direction: column;
            align-items:flex-start;            
            box-sizing: border-box;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background-color: rgba(40, 40, 40, 0.9);
            padding: 8px;
            padding-left: 12px;
            margin: 0;
        }
        .note{
            padding: 0;
            margin: 0;
            color: #ffffff;
            height: 20px;
            display: flex;
            align-items:center;
            font-size: 14px;
        }
        .caculate{
            position: relative;
            align-items:center;
            display: flex;
            box-sizing: border-box;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 0px;
        }
        .cacuplace{
            width: 72px;
            height: 100px;
            background-color: rgba(87, 87, 87, 0.7);
            margin: 4px;
            border-radius:5px;
        }
        .result{
            display: flex;
            align-items:center;
            box-sizing: border-box;
            width:100px;
            height: 100px;
            margin: 4px;
            padding: 12px;
            background-color: #ffffff;
            color: #585858;
            border-radius:5px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 900;
        }
        .twoRL{
            background-color: #ffabab;
        }
        .twofiveRL{
            background-color: #fff3b1;
        }
        .threeRL{
            background-color: #dcffbb;
        }
        .threefiveRL{
            background-color: #c2fffa;
        }
        .fourRL{
            background-color: #cdaeff;
        }

        @media (max-width: 760px) {
            .container {
                flex-direction: column;
            }
            #Elysioncolum, #Tetracolum, #Missiliscolum, #Pilgrimcolum, #Abnormalcolum{
                width: 100%;
            }
            .caculateArea{
                height: fit-content;
            }
            .caculate{
                flex-wrap: wrap;
            }
        }


    </style>

</head>
<body>

    <div class="container">
        <div class="column" id="Elysioncolum">
            <div class="corpbk"></div>
            <div class="corplogo">
                <img  src="https://sg-tools-cdn.blablalink.com/icon/atlas_common_corp/icn_corp_01.webp">
            </div>
            <p class="enterprise">Elysion</p>
            <div class="columnin" id="Elysionpvp"></div>
            <div class="show" id="showElysion">
                <p>其他角色⯆</p>
            </div>
            <div class="columnin" id="Elysion">
                <div class="hide" id="hideElysion">
                    <p>隱藏⯅</p>
                </div>
            </div>
        </div>
        <div class="column" id="Missiliscolum">
            <div class="corpbk"></div> 
            <div class="corplogo">
                <img src="https://sg-tools-cdn.blablalink.com/icon/atlas_common_corp/icn_corp_02.webp">
            </div>            
            <p class="enterprise">Missilis</p>
            <div class="columnin" id="Missilispvp"></div>
            <div class="show" id="showMissilis">
                <p>其他角色⯆</p>
            </div>
            <div class="columnin" id="Missilis">
                <div class="hide" id="hideMissilis">
                    <p>隱藏⯅</p>
                </div>
            </div>
        </div>
        <div class="column" id="Tetracolum">
            <div class="corpbk"></div> 
            <div class="corplogo">
                <img src="https://sg-tools-cdn.blablalink.com/icon/atlas_common_corp/icn_corp_03.webp">
            </div>
            <p class="enterprise">Tetra</p>
            <div class="columnin" id="Tetrapvp"></div>
            <div class="show" id="showTetra">
                <p>其他角色⯆</p>
            </div>
            <div class="columnin" id="Tetra">
                <div class="hide" id="hideMissilis">
                    <p>隱藏⯅</p>
                </div>
            </div>
        </div>
        <div class="column" id="Pilgrimcolum">
            <div class="corpbk"></div> 
            <div class="corplogo" >
                <img src="https://sg-tools-cdn.blablalink.com/icon/atlas_common_corp/icn_corp_04.webp">
            </div>
            <p class="enterprise">Pilgrim</p>
            <div class="columnin" id="Pilgrimpvp"></div>
            <div class="show" id="showPilgrim">
                <p>其他角色⯆</p>
            </div>
            <div class="columnin" id="Pilgrim">
                <div class="hide" id="hideMissilis">
                    <p>隱藏⯅</p>
                </div>
            </div>
        </div>
        <div class="column" id="Abnormalcolum">
            <div class="corpbk"></div> 
            <div class="corplogo">
                <img src="https://sg-tools-cdn.blablalink.com/icon/atlas_common_corp/icn_corp_05.webp">
            </div>
            <p class="enterprise">Abnormal</p>
            <div class="columnin" id="Abnormalpvp"></div>
            <div class="show" id="showAbnormal">
                <p>其他角色⯆</p>
            </div>
            <div class="columnin" id="Abnormal">
                <div class="hide" id="hideMissilis">
                    <p>隱藏⯅</p>
                </div>
            </div>
        </div>
  </div>

  <div class="blank">

  </div>
  
  <div class="caculateArea">
    <div class="note">
        <p>*珍藏品</p>
    </div>
    <div class="caculate">
        <div id="cacuplace1" class="cacuplace">
        </div>
        <div id="cacuplace2" class="cacuplace">
        </div>
        <div id="cacuplace3" class="cacuplace">
        </div>
        <div id="cacuplace4" class="cacuplace">
        </div>
        <div id="cacuplace5" class="cacuplace">
        </div>
        <div id="result" class="result">
            <p style="color: #b4b4b4;">點選角色開始計算</p>
        </div>
    </div>    
    
  </div>


  <script>    

    //速度級：級別代稱, 2RL, 2.5RL, 3RL, 3.5RL, 4RL, 額外充能
    var speed = [
        ["Helm", 39.82, 39.82, 59.73, 59.73, 79.64, 0],
        ["Trina", 28.8, 28.8, 43.2, 43.2, 57.6, 0],
        ["Jackal", 28.4, 28.4, 42.6, 42.6, 56.8, 1],
        ["Anis", 28.4, 28.4, 42.6, 42.6, 56.8, 0],
        ["Centi", 27.6, 27.6, 41.4, 41.4, 55.2, 0],
        ["Rumani", 26, 26, 39, 39, 52, 0],
        ["Emilia", 25.2, 25.2, 37.8, 37.8, 50.4, 0],
        ["Noah", 24, 24, 36, 36, 48, 0],
        ["Maiden: Ice Rose", 18.2, 18.2, 27.3, 27.3, 36.4],
        ["Drake", 18, 22.95, 27.45, 31.95, 36.45, 0],
        ["Noir", 18, 22.5, 27, 31.5, 36, 0],
        ["Laplace", 17.4, 17.4, 26.1, 26.1, 34.8, 0],
        ["Rapunzel", 11.6, 11.6, 17.4, 17.4, 23.2, 0],
        ["Scarlet", 11.7, 13.5, 17.1, 20.25, 23.4, 1],
        ["Noise", 11.2, 11.2, 16.8, 16.8, 22.4, 0],
        ["Scarlet: Black Shadow", 8.75, 11.25, 13.75, 18.75, 20, 1],
        ["Anis: Sparkling Summer", 10, 13, 13, 13, 15.5, 0],
        ["Naga", 8, 10, 12, 14, 16, 0],
        ["Moran", 6.5, 7.5, 9.5, 11.25, 13, 0],
        ["Red Hood", 5.6, 5.6, 8.4, 8.4, 11.2, 1],
        ["Maxwell", 5.6, 5.6, 8.4, 8.4, 11.2, 0],
        ["Blanc", 5.2, 6, 7.6, 9, 10.4, 0],
        ["Liter", 3.2, 3.9, 5.4, 6.2, 6.9, 0],
        ["Cinderella", 2.025, 3.375, 4.725, 5.4, 7.2, 0],
        ["Crown", 1.7, 2.3, 3.55, 4.25, 5.25, 0]
    ];

    //角色資訊：企業(後綴pvp為常用角), 英文, 中文, 編號, 速度級
    var character = [
        ["Elysionpvp", "Helm", "海倫*", "352", "Helm"],
        ["Elysionpvp", "Maiden", "梅登", "181", "Noir"],
        ["Elysionpvp", "Maiden: Ice Rose", "冰梅登", "183", "Maiden: Ice Rose"],
        ["Elysionpvp", "Privaty", "普麗瓦蒂","170","Blanc"],
        ["Elysion", "Emma", "艾瑪","090","Crown"],
        ["Elysion", "Signal", "西格娜", "022","Liter"],
        ["Elysion", "Poli", "波莉", "030","Naga"],
        ["Missilispvp", "Centi", "桑迪", "080", "Centi"],
        ["Missilispvp", "Jackal", "豺狼", "111", "Jackal"],
        ["Missilispvp", "Drake", "德雷克*", "101", "Drake"],
        ["Missilispvp", "Pepper", "佩珀", "131", "Noir"],
        ["Missilispvp", "Laplace", "拉普拉斯*", "100", "Laplace"],
        ["Missilispvp", "Anne: Miracle Fairy", "聖誕安妮", "121", "Noise"],
        ["Missilispvp", "Tia", "蒂亞", "451", "Noise"],
        ["Missilispvp", "Trina", "特蕾娜", "412", "Trina"],
        ["Missilis","Maxwell","麥斯威爾","102","Maxwell"],
        ["Missilis", "Liter", "麗塔", "082", "Liter"],
        ["Missilis", "Naga", "娜嘉", "450", "Naga"],
        ["Tetrapvp", "Anis", "SR阿妮斯", "012", "Anis"],
        ["Tetrapvp", "Blanc", "布蘭兒", "270", "Blanc"],
        ["Tetrapvp", "Rumani", "魯瑪妮", "240", "Blanc"],
        ["Tetrapvp", "Viper", "毒蛇", "112", "Noir"],
        ["Tetrapvp", "Sugar", "舒格", "140", "Noir"],
        ["Tetrapvp", "Noir", "諾亞爾", "271", "Noir"],
        ["Tetrapvp", "Soda: Twinkling Bunny", "索達兔", "314", "Noir"],
        ["Tetrapvp", "Noise", "諾伊斯", "430", "Noise"],
        ["Tetrapvp", "Biscuit", "餅乾", "381", "Noise"],
        ["Tetrapvp", "Bay", "貝伊", "550", "Noise"],
        ["Tetrapvp", "Anis: Sparkling Summer", "泳阿尼斯", "015", "Anis: Sparkling Summer"],
        ["Tetrapvp", "Moran", "牡丹", "281", "Moran"],
        ["Pilgrimpvp", "Noah", "諾雅", "232", "Noah"],
        ["Pilgrimpvp", "Rapunzel", "長髮公主", "221", "Rapunzel"],
        ["Pilgrimpvp", "Scarlet", "紅蓮", "222", "Scarlet"],
        ["Pilgrimpvp", "Scarlet: Black Shadow", "暗影紅蓮", "225", "Scarlet: Black Shadow"],
        ["Pilgrimpvp", "Red Hood", "小紅帽", "470", "Red Hood"],
        ["Pilgrimpvp", "Cinderella", "灰姑娘", "511", "Cinderella"],
        ["Pilgrim", "Crown", "皇冠", "330", "Crown"],
        ["Abnormalpvp", "Emilia", "愛蜜莉雅", "821", "Emilia"]
        
    ];
    //優化圖片載入時間點
    document.addEventListener('DOMContentLoaded', () => {
        //pvp常用角優先載入
        const allPvpImages = document.querySelectorAll(
            'img[data-group="Elysionpvp"], img[data-group="Missilispvp"], img[data-group="Tetrapvp"], img[data-group="Pilgrimpvp"], img[data-group="Abnormalpvp"]'
        );
        allPvpImages.forEach(pvpimg => {
            pvpimg.src = pvpimg.dataset.src;
            delete pvpimg.dataset.src;
        });                

        //Elysion其他角色圖片載入
        const showElysion = document.getElementById('showElysion');
        const ElysionImages = document.querySelectorAll('img[data-group="Elysion"]');
        showElysion.addEventListener('click', () => {
            ElysionImages.forEach(ElysionImage => {
            if (ElysionImage.dataset.src) {
                ElysionImage.src = ElysionImage.dataset.src;
                // (可選) 移除 data-src 屬性，避免重複載入
                delete ElysionImage.dataset.src;
            }
            });
        });

        //Missilis其他角色圖片載入
        const showMissilis = document.getElementById('showMissilis');
        const MissilisImages = document.querySelectorAll('img[data-group="Missilis"]');
        showMissilis.addEventListener('click', () => {
            MissilisImages.forEach(MissilisImage => {
            if (MissilisImage.dataset.src) {
                MissilisImage.src = MissilisImage.dataset.src;
                // (可選) 移除 data-src 屬性，避免重複載入
                delete MissilisImage.dataset.src;
            }
            });
        });

        //Tetra其他角色圖片載入
        const showTetra = document.getElementById('showTetra');
        const TetraImages = document.querySelectorAll('img[data-group="Tetra"]');
        showTetra.addEventListener('click', () => {
            TetraImages.forEach(TetraImage => {
            if (TetraImage.dataset.src) {
                TetraImage.src = TetraImage.dataset.src;
                // (可選) 移除 data-src 屬性，避免重複載入
                delete TetraImage.dataset.src;
            }
            });
        });

        //Pilgrim其他角色圖片載入
        const showPilgrim = document.getElementById('showPilgrim');
        const PilgrimImages = document.querySelectorAll('img[data-group="Pilgrim"]');
        showPilgrim.addEventListener('click', () => {
            PilgrimImages.forEach(PilgrimImage => {
            if (PilgrimImage.dataset.src) {
                PilgrimImage.src = PilgrimImage.dataset.src;
                // (可選) 移除 data-src 屬性，避免重複載入
                delete PilgrimImage.dataset.src;
            }
            });
        });

        //Abnormal其他角色圖片載入
        const showAbnormal = document.getElementById('showAbnormal');
        const AbnormalImages = document.querySelectorAll('img[data-group="Abnormal"]');
        showAbnormal.addEventListener('click', () => {
            AbnormalImages.forEach(AbnormalImage => {
            if (AbnormalImage.dataset.src) {
                AbnormalImage.src = AbnormalImage.dataset.src;
                // (可選) 移除 data-src 屬性，避免重複載入
                delete AbnormalImage.dataset.src;
            }
            });
        });
    });        
        
    for (let i = 0; i < character.length; i++) {
        if (character[i]) {
            let parentDiv = document.getElementById(character[i][0]);

            let charactername = character[i][2];

            let photosrc = "https://sg-tools-cdn.blablalink.com/character/mi/mi_c";
            photosrc += character[i][3];
            photosrc += "_00_s.webp";

            const item = document.createElement('div');
            item.classList.add('item', character[i][3]);
            item.innerHTML = `
            <div class="itemhover">
            </div>
            <img data-group=${character[i][0]} data-src=${photosrc} alt="Delayed Image">
            <p class=charactername>${charactername}</p>
            `;

            // 檢查 parentDiv 是否存在
            if (parentDiv) {
            parentDiv.appendChild(item);
            } else {
            console.error(`找不到 id 為 ${character[i][0]} 的父元素。`);
            };
        };
    };
    
    const chars = document.querySelectorAll('.item');
    const selectedChars = [null, null, null, null, null]; // 使用 null 作為預留位置
    const speedchars = [null, null, null, null, null];
    

    chars.forEach(char => {
        char.addEventListener('click', () => {
            const index = selectedChars.indexOf(char);

            if (index !== -1) {
                // 如果已選取，則取消選取
                char.classList.remove(`selected${index + 1}`);
                selectedChars[index] = null;
                speedchars[index] = null; // 清除 speedchars 陣列
                const cacuplace = document.getElementById(`cacuplace${index + 1}`);
                cacuplace.replaceChildren();
            } else {
                // 如果未選取，則新增選取
                const emptyIndex = selectedChars.findIndex(item => item === null);

                if (emptyIndex !== -1) {
                    // 檢查是否已達到選取上限
                    if (selectedChars.filter(item => item !== null).length < 5) {
                        selectedChars[emptyIndex] = char;
                        char.classList.add(`selected${emptyIndex + 1}`);
                        const clonedchar = char.cloneNode(true);

                        character.forEach((subArray) => {
                            if (subArray[3] === clonedchar.classList[1]) {
                                const charspeed = subArray[4];

                                speed.forEach((speedsubArray) => {
                                    if (speedsubArray[0] === charspeed) {
                                        speedchars[emptyIndex] = speedsubArray; // 將 speed 子陣列存儲到 speedchars
                                    };
                                });
                            };
                        });

                        const cacuplace = document.getElementById(`cacuplace${emptyIndex + 1}`);
                        cacuplace.appendChild(clonedchar);

                        // 為 cacuplace 中的 clonedchar 添加點擊事件監聽器
                        clonedchar.addEventListener('click', function(event) {
                            event.stopPropagation(); // 阻止事件阻擋

                            // 找到 clonedchar 在 selectedChars 中的索引
                            const clonedIndex = selectedChars.indexOf(char);
                            if (clonedIndex !== -1) {
                                // 取消選取
                                char.classList.remove(`selected${clonedIndex + 1}`);
                                selectedChars[clonedIndex] = null;                                
                                speedchars[clonedIndex] = null;
                                cacuplace.replaceChildren();   
                                
                                //更新總速度和加成
                                calculateAndDisplay();
                            };
                        });
                    };
                };
            };
            
            // 計算總速度和加成
            function calculateAndDisplay() {                
                const sums = {
                    twoRL: 0,
                    twofiveRL: 0,
                    threeRL: 0,
                    threefiveRL: 0,
                    fourRL: 0,
                    bonusSpeed: 0
                };

                speedchars.forEach(subArray => {
                    if (subArray) {
                        sums.twoRL += subArray[1] || 0;
                        sums.twofiveRL += subArray[2] || 0;
                        sums.threeRL += subArray[3] || 0;
                        sums.threefiveRL += subArray[4] || 0;
                        sums.fourRL += subArray[5] || 0;
                        sums.bonusSpeed += subArray[6] || 0;
                    };
                });

                // 處理浮點數精度問題並找到最大值
                let maxKey = "over4RL"; // 預設值
                let maxValue = 0;
                for (const key in sums) {
                    sums[key] = Math.round(sums[key] * 100) / 100; // 四捨五入到小數點後兩位

                    if (sums[key] >= 100) {
                        if (maxValue === 0 || sums[key] < maxValue) {
                            maxValue = sums[key];
                            maxKey = key;
                            
                        };
                    };
                };            

                // 設定結果名稱
                let resultname = maxKey;
                if (maxKey === "twoRL"){
                    resultname = "2RL";
                };
                if (maxKey === "twofiveRL"){
                    resultname = "2.5RL";
                };
                if (maxKey === "threeRL"){
                    resultname = "3RL";
                };
                if (maxKey === "threefiveRL"){
                    resultname = "3.5RL";
                };
                if (maxKey === "fourRL"){
                    resultname = "4RL";
                };
                if (sums.bonusSpeed > 0) {
                resultname += "+";
                };

                // 顯示結果
                result.className = "result";
                result.classList.add(maxKey);
                let finalspeed = 0;


                if(maxValue === 0){
                    finalspeed = sums.fourRL;
                } else {
                    finalspeed = maxValue;
                };

                result.innerHTML = `<p>${resultname}<br>(${finalspeed})</p>`;

                console.log("計算結果:", sums);
            }
            calculateAndDisplay();
        });
    });
    
    
    const columns = document.querySelectorAll('.column');

    columns.forEach(column => {
        const showButton = column.querySelector('.show');
        const hideButton = column.querySelector('.hide');
        const columninDiv = column.querySelector('.columnin:last-child'); // 假設 columnin 是最後一個子元素

        if (showButton && hideButton && columninDiv) {
            columninDiv.style.display = 'none'; // 初始狀態隱藏

            showButton.addEventListener('click', function() {
                columninDiv.style.display = 'flex';
                showButton.style.display = 'none';
            });

            hideButton.addEventListener('click', function() {
                columninDiv.style.display = 'none';
                showButton.style.display = 'flex';
            });
        };
    });

    
  </script>
  
    
</body>
</html>